<div class="sales-report-container">
  <mat-card class="report-header">
    <mat-card-header>
      <mat-card-title>Sales Report</mat-card-title>
      <mat-card-subtitle>
        Analyze your sales performance and trends
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <!-- Report Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="reportForm" class="filters-form">
        <mat-form-field appearance="outline">
          <mat-label>Start Date</mat-label>
          <input
            matInput
            [matDatepicker]="startPicker"
            formControlName="startDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="startPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>End Date</mat-label>
          <input
            matInput
            [matDatepicker]="endPicker"
            formControlName="endDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="endPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Report Type</mat-label>
          <mat-select formControlName="reportType">
            <mat-option value="daily">Daily</mat-option>
            <mat-option value="weekly">Weekly</mat-option>
            <mat-option value="monthly">Monthly</mat-option>
          </mat-select>
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          (click)="generateReport()"
          [disabled]="loading"
        >
          Generate Report
        </button>

        <button
          mat-button
          (click)="exportReport()"
          [disabled]="loading || !salesData"
        >
          <mat-icon>download</mat-icon>
          Export
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Generating report...</p>
  </div>

  <!-- Report Content -->
  <div *ngIf="salesData && !loading" class="report-content">
    <!-- Summary Cards -->
    <div class="summary-grid">
      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon">
            <mat-icon>shopping_cart</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ salesData.totalSales }}</div>
            <div class="metric-label">Total Sales</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon revenue">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">
              {{ salesData.totalRevenue | currencyFormat }}
            </div>
            <div class="metric-label">Total Revenue</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon average">
            <mat-icon>calculate</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">
              {{ salesData.averageOrderValue | currencyFormat }}
            </div>
            <div class="metric-label">Avg Order Value</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Sales Trend</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="salesChartData"
              [options]="salesChartOptions"
              type="line"
            ></canvas>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Revenue by Period</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-container">
            <canvas
              baseChart
              [data]="revenueChartData"
              [options]="revenueChartOptions"
              type="bar"
            ></canvas>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Top Products Table -->
    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>Top Selling Products</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table
          mat-table
          [dataSource]="salesData.topProducts"
          class="top-products-table"
        >
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Product</th>
            <td mat-cell *matCellDef="let product">{{ product.name }}</td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Quantity Sold</th>
            <td mat-cell *matCellDef="let product">{{ product.quantity }}</td>
          </ng-container>

          <ng-container matColumnDef="revenue">
            <th mat-header-cell *matHeaderCellDef>Revenue</th>
            <td mat-cell *matCellDef="let product">
              {{ product.revenue | currencyFormat }}
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="['name', 'quantity', 'revenue']"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: ['name', 'quantity', 'revenue']"
          ></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>
