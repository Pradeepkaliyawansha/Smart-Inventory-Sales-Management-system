<div class="inventory-report-container">
  <mat-card class="report-header">
    <mat-card-header>
      <mat-card-title>Inventory Report</mat-card-title>
      <mat-card-subtitle>
        Monitor your stock levels and inventory movements
      </mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <!-- Report Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="reportForm" class="filters-form">
        <mat-form-field appearance="outline">
          <mat-label>Start Date</mat-label>
          <input
            matInput
            [matDatepicker]="startPicker"
            formControlName="startDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="startPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>End Date</mat-label>
          <input
            matInput
            [matDatepicker]="endPicker"
            formControlName="endDate"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="endPicker"
          ></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select formControlName="category">
            <mat-option value="all">All Categories</mat-option>
            <mat-option value="electronics">Electronics</mat-option>
            <mat-option value="clothing">Clothing</mat-option>
            <mat-option value="books">Books</mat-option>
          </mat-select>
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          (click)="generateReport()"
          [disabled]="loading"
        >
          Generate Report
        </button>

        <button
          mat-button
          (click)="exportReport()"
          [disabled]="loading || !inventoryData"
        >
          <mat-icon>download</mat-icon>
          Export
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Generating inventory report...</p>
  </div>

  <!-- Report Content -->
  <div *ngIf="inventoryData && !loading" class="report-content">
    <!-- Summary Cards -->
    <div class="summary-grid">
      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon">
            <mat-icon>inventory</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ inventoryData.totalProducts }}</div>
            <div class="metric-label">Total Products</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon value">
            <mat-icon>attach_money</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">
              {{ inventoryData.totalValue | currencyFormat }}
            </div>
            <div class="metric-label">Total Value</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon warning">
            <mat-icon>warning</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ inventoryData.lowStockItems }}</div>
            <div class="metric-label">Low Stock Items</div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card">
        <mat-card-content>
          <div class="metric-icon error">
            <mat-icon>remove_circle</mat-icon>
          </div>
          <div class="metric-content">
            <div class="metric-value">{{ inventoryData.outOfStockItems }}</div>
            <div class="metric-label">Out of Stock</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Categories and Stock Movements -->
    <div class="content-grid">
      <!-- Top Categories -->
      <mat-card class="categories-card">
        <mat-card-header>
          <mat-card-title>Top Categories by Value</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div
            *ngFor="let category of inventoryData.topCategories"
            class="category-item"
          >
            <div class="category-info">
              <div class="category-name">{{ category.name }}</div>
              <div class="category-stats">
                {{ category.productCount }} products â€¢
                {{ category.totalValue | currencyFormat }}
              </div>
            </div>
            <div class="category-progress">
              <mat-progress-bar
                mode="determinate"
                [value]="(category.totalValue / inventoryData.totalValue) * 100"
              ></mat-progress-bar>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Recent Stock Movements -->
      <mat-card class="movements-card">
        <mat-card-header>
          <mat-card-title>Recent Stock Movements</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="table-container">
            <table
              mat-table
              [dataSource]="inventoryData.stockMovements"
              class="movements-table"
            >
              <ng-container matColumnDef="productName">
                <th mat-header-cell *matHeaderCellDef>Product</th>
                <td mat-cell *matCellDef="let movement">
                  {{ movement.productName }}
                </td>
              </ng-container>

              <ng-container matColumnDef="movement">
                <th mat-header-cell *matHeaderCellDef>Type</th>
                <td mat-cell *matCellDef="let movement">
                  <mat-chip
                    [class]="'movement-' + movement.movement"
                    class="movement-chip"
                  >
                    <mat-icon>{{
                      movement.movement === "in"
                        ? "arrow_downward"
                        : "arrow_upward"
                    }}</mat-icon>
                    {{ movement.movement === "in" ? "Stock In" : "Stock Out" }}
                  </mat-chip>
                </td>
              </ng-container>

              <ng-container matColumnDef="quantity">
                <th mat-header-cell *matHeaderCellDef>Quantity</th>
                <td mat-cell *matCellDef="let movement">
                  {{ movement.quantity }}
                </td>
              </ng-container>

              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let movement">
                  {{ movement.date | dateFormat : "short" }}
                </td>
              </ng-container>

              <ng-container matColumnDef="reference">
                <th mat-header-cell *matHeaderCellDef>Reference</th>
                <td mat-cell *matCellDef="let movement">
                  {{ movement.reference }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
